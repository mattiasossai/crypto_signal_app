# .github/workflows/download_history.yml
name: Download 4yr Historical Data (Split)

on:
  workflow_dispatch:

jobs:
  download:
    name: Download 4yr History (per Symbol × Part)
    runs-on: ubuntu-latest

    strategy:
      matrix:
        symbol: [BTCUSDT,ETHUSDT,BNBUSDT,XRPUSDT,SOLUSDT,ENAUSDT]
        part:   [part1,part2]

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Make download script executable
        run: chmod +x train/download_data_range.sh

      - name: Download ${{ matrix.symbol }} – ${{ matrix.part }}
        shell: bash
        run: |
          # setze Zeitspanne je Part
          if [ "${{ matrix.part }}" = "part1" ]; then
            START=$(date -I -d "4 years ago")
            END=$(date -I -d "2 years ago")
          else
            START=$(date -I -d "2 years ago")
            END=$(date -I -d "yesterday")
          fi

          # Erstelle Zielverzeichnis
          TARGET=historical/${{ matrix.symbol }}/${{ matrix.part }}
          mkdir -p "$TARGET"

          # Download aller Daily-ZIPs
          train/download_data_range.sh \
            "${{ matrix.symbol }}" 1m "$START" "$END" \
            "$TARGET"

      - name: Zip & upload artifact
        shell: bash
        run: |
          mkdir -p artifacts
          zip -j \
            artifacts/hist-${{ matrix.symbol }}-${{ matrix.part }}.zip \
            historical/${{ matrix.symbol }}/${{ matrix.part }}/*.zip

      - name: Upload history artifact
        uses: actions/upload-artifact@v4
        with:
          name: hist-${{ matrix.symbol }}-${{ matrix.part }}
          path: artifacts/hist-${{ matrix.symbol }}-${{ matrix.part }}.zip
